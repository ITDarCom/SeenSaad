<template name='add'>
    {{#if canEdit}}
        <div class='row'>
            <div class='col-md-offset-1 col-md-10'>
                {{> headerText}}
                {{#if allowedTime}}
                    {{#autoForm collection='Articles' id='addUpdateArticles' name='addUpdateArticles' doc=thisArticle
                    type=formType }}
                        <fieldset>
                            {{> afQuickField name='title'}}
                            {{> afQuickField name='body'}}
                            <div class='row'>
                                <div class='{{#if afFieldValueIs name="contributingPermissions" value="1"}}col-md-2 col-xs-2
                            {{else}}col-xs-12 col-md-12{{/if}}'>
                                    {{> afQuickField name='contributingPermissions' id='contributingPermissions'}}
                                </div>
                                {{#if afFieldValueIs name='contributingPermissions' value='1'}}

                                    <div class='col-md-10 col-xs-10'>
                                        {{> afQuickField name='contributingIds' label=false options=usersOptions
                                        select2Options=s2Opts }}
                                    </div>

                                {{/if}}
                            </div>
                            <div id='readingDiv'>
                                <div class='row'>
                                    <div class='{{#if afFieldValueIs name="readingPermissions" value="1"}}
                                col-xs-2 col-md-2{{else}}col-xs-12 col-md-12{{/if}}'>
                                        {{> afQuickField name='readingPermissions' id='readingPermissions'  }}</div>
                                    {{#if afFieldValueIs name='readingPermissions' value='1'}}
                                        <div class='col-xs-10 col-md-10'>
                                            {{> afQuickField label=false options=usersOptions name='readingIds' }}</div>
                                    {{/if}}
                                </div>
                            </div>
                        </fieldset>
                        <button type='submit' class='btn btn-block btn-primary'>{{saveButton}}</button>
                    {{/autoForm}}
                {{else}}
                    {{#with thisArticle}}
                        <div class="form-group" data-required="true">
                            <label class="control-label">العنوان</label>
                            <input type="text" value="{{title}}" disabled class="form-control">
                        </div>
                        <div class="form-group" data-required="true">
                            <label class="control-label">الموضوع</label>

                            <div class="panel panel-default">
                                <div class="panel-heading"><i class="fa fa-lock"></i> محتوى مغلق لا يمكنك
                                    التعديل
                                </div>
                                <div class="panel-body">
                                    {{{body}}}
                                </div>
                            </div>
                        </div>
                        {{> articleExtensions}}
                        {{#if canAddExtension}}
                            {{#autoForm  id='addExtension' name='addExtension'  meteormethod='addExtension'  type='method'  schema='extensionSchema' }}
                                <fieldset>
                                    {{> afQuickField name='extensionText' id='extensionText' label=false }}
                                    {{> afQuickField name='articleId' id='articleId' type='hidden' label=false value=this._id}}
                                </fieldset>
                                <button type='submit' class='btn btn-block btn-primary'>
                                    {{getArabicMsg 'addButtonLabel'}}</button>
                                <br>
                            {{/autoForm}}
                        {{else}}
                            {{#if lastExtensionUpdate}}
                                {{#autoForm id='lastExtentionUpdate'  name='lastExtentionUpdate' type='update'
                                doc=lastExtensionUpdate collection='articlesExtension'}}
                                    <fieldset>
                                        {{> afQuickField name='extensionText' id='extensionText' label=false }}
                                        {{> afQuickField name='articleId' id='articleId' type='hidden' label=false value=this._id}}
                                    </fieldset>
                                    <button type='submit' class='btn btn-block btn-primary'>
                                        {{getArabicMsg 'editButtonTitle'}}</button>
                                {{/autoForm}}
                                <br>
                            {{/if}}
                        {{/if}}
                        {{#autoForm collection='Articles' id='updatePermissionsForm' name ='updatePermissionsForm'
                        doc=this type='update'}}
                            <fieldset>
                                <div class='row'>
                                    <div class='{{#if afFieldValueIs name="contributingPermissions" value="1"}}col-md-2 col-xs-2
                            {{else}}col-xs-12 col-md-12{{/if}}'>
                                        {{> afQuickField name='contributingPermissions' id='contributingPermissions'}}
                                    </div>
                                    {{#if afFieldValueIs name='contributingPermissions' value='1'}}
                                        <div class='col-md-10 col-xs-10'>
                                            {{> afQuickField name='contributingIds' label=false options=usersOptions
                                            select2Options=s2Opts }}
                                        </div>
                                    {{/if}}
                                </div>
                                <div id='readingDiv'>
                                    <div class='row'>
                                        <div class='{{#if afFieldValueIs name="readingPermissions" value="1"}}
                                col-xs-2 col-md-2{{else}}col-xs-12 col-md-12{{/if}}'>
                                            {{> afQuickField name='readingPermissions' id='readingPermissions'  }}</div>
                                        {{#if afFieldValueIs name='readingPermissions' value='1'}}
                                            <div class='col-xs-10 col-md-10'>
                                                {{> afQuickField label=false options=usersOptions name='readingIds' }}</div>
                                        {{/if}}
                                    </div>
                                </div>
                            </fieldset>
                            <button type='submit' class='btn btn-block btn-primary'
                                    value="updatePermissionsForm">{{saveButton}}</button>
                        {{/autoForm}}
                    {{/with}}
                {{/if}}
            </div>
        </div>
    {{else}}
        <div class='alert alert-warning'>
            <blockquote> {{getArabicMsg articleAccessDenied}}</blockquote>
        </div>
    {{/if}}
</template>
