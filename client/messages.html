<template name="messages" xmlns="http://www.w3.org/1999/html" xmlns="http://www.w3.org/1999/html">
    <div class="col-md-offset-1 col-md-10 col-md-offset-1">
        <h1>الرسائل</h1>
        <small>الرسائل الخاصة المتبادلة مع أعضاء الموقع</small>
        <hr class="title">
        <button type="button" class="btn btn-default sendMsgBtn">أرسل رسالة</button>
        <div id="sendMsgDiv" hidden>
            {{#autoForm collection="Messages" id="sendMsg"  type="insert" }}
                <fieldset>
                    {{> afQuickField name="to" select2Options=s2Opts}}
                    {{> afQuickField name="message"}}
                </fieldset>
                <button type="submit" class="btn btn-primary">أرسل</button>
            {{/autoForm}}

        </div>
        <hr>
        {{#each senders}}
            <div class="panel-group">
                <div class="panel panel-info">
                    <div class="panel-heading">
                        <div class="row">
                            <div class="col-md-offset-2 col-xs-offset-2 col-md-4 col-xs-4">
                                <span class="glyphicon glyphicon-user" aria-hidden="true"></span> <a
                                    href="{{pathFor 'profile' id=this}}">{{userUsername this}}</a>
                            </div>
                            <div class="col-md-4">
                                <span class="glyphicon glyphicon-time"
                                      aria-hidden="true"></span> {{dateFormated lastMessageSendingAt}}
                            </div>
                        </div>
                    </div>
                    <div class="panel-body">
                        <div class="row">
                            <div class="col-md-offset-1 col-md-11 col-xs-offset-1 col-xs-11">
                                <a href="{{pathFor route='messageStream' id=this}}"><h4
                                        class="col-md-8">{{{lastMessage}}}</h4></a>

                            </div>

                        </div>
                    </div>
                </div>
            </div>
        {{/each}}
    </div>
</template>


<template name="messageStream">
    <div class="row">
        <div class="col-md-offset-1 col-md-10">
            <div class="panel panel-info">
                <div class="panel-heading">
                    <h4> رسائل العضو: {{userUsername currentId}}</h4>
                </div>
                <div class="panel-body">
                    {{#each messages }}
                        <div class="row">
                            {{#if fromMe}}
                                <div class="col-md-1 col-xs-1">
                                    <a href="{{pathFor 'profile' id=this.from}}"> <img class="img-circle" height="42"
                                                                                       width="42"
                                                                                       src="{{getProfilePic}}"
                                                                                       alt="{{userUsername this.from}}"
                                                                                       title="{{userUsername this.from}}"></a>
                                </div>
                                <div class="col-md-11 col-xs-11 msg">
                                    <div class="clearfix pull-right">
                                        <button class="btn hidden btn-xs btn-danger deleteMsgBtn pull-left ">
                                            <small><i class="fa fa-trash "></i></small>
                                        </button>
                                        <blockquote class="me">{{{nl2br message}}}
                                            <small>{{momentIt sendingAt}}</small>
                                        </blockquote>

                                    </div>
                                </div>
                            {{else}}
                                <div class="col-md-11 col-xs-11 msg">

                                    <div class="clearfix pull-left">
                                        <button class="hidden btn btn-xs btn-danger deleteMsgBtn pull-right">
                                            <small><i class="fa fa-trash"></i></small>
                                        </button>
                                        <blockquote class="you">{{{nl2br message}}}
                                            <small>{{momentIt sendingAt}}</small>
                                        </blockquote>
                                    </div>
                                </div>
                                <div class="col-md-1 col-xs-1">
                                    <a href="{{pathFor 'profile' id=this.from}}"> <img class="img-circle" height="42"
                                                                                       width="42"
                                                                                       src="{{getProfilePic currentId}}"
                                                                                       alt="{{userUsername this.from}}"
                                                                                       title="{{userUsername this.from}}"></a>
                                </div>

                            {{/if}}
                        </div>
                    {{/each}}
                </div>
            </div>
        </div>
    </div>
    <div class="row">
        <div class="col-md-10 col-xs-10 col-md-offset-1 col-xs-1">
            <div class="panel panel-info">
                <div class="panel-body">
                    {{#autoForm id="sendMsgToUser" type="insert" collection="Messages" }}
                        {{> afFieldInput name= 'to' type="hidden" value=thisUser}}
                        {{> afFieldInput name='message' placeholder="اكتب رسالة"   rows=2}}
                        <button type="submit" class="btn btn-primary form-control">أرسل</button>
                    {{/autoForm}}
                </div>
            </div>
        </div>
    </div>
</template>

